#include <SoftwareSerial.h>

SoftwareSerial BTserial(2, 3);

char c = ' ';
boolean NL = true;

void setup() {
    Serial.begin(9600);
    Serial.print("Sketch:   ");   Serial.println(__FILE__);
    Serial.print("Uploaded: ");   Serial.println(__DATE__);
    Serial.println(" ");
    
    BTserial.begin(38400);
    Serial.println("BTserial started at 38400");
    
    Serial.println("Envoi de la commande AT");
    BTserial.println("AT+ROLE=1");
    delay(100);
    BTserial.println("AT+CMODE=1");
    delay(100);
    BTserial.println("AT+PSWD=1234");
    delay(100);
    BTserial.println("AT+INQM=0,8,15");
    delay(100);
    BTserial.println("AT+RESET");
    delay(1000);
    BTserial.println("AT+INIT");
    delay(200);
    BTserial.println("AT+INQ");
    Serial.println("Attente de la réponse");
    while (BTserial.available()<=0); 
    Serial.println("Affichage de la réponse");
    while (BTserial.available()>0){
       Serial.write(BTserial.read());
    }
    delay(20000);
    BTserial.println("AT+DISC");
}


void loop() {

   //ATCommande("ROLE=1");
   //Serial.println(BTserial.read());
    
    /*Serial.println("Envoi de la commande AT");
    BTserial.print("AT"); 
    Serial.println("Attente de la réponse");
    while (BTserial.available()<=0); 
    Serial.println("Affichage de la réponse");
    while (BTserial.available()>0){
       Serial.println(BTserial.read());
    }*/
    
  if (BTserial.available())
  {
    c = BTserial.read();
    Serial.write(c);
    
  }

  // Read from the Serial Monitor and send to the Bluetooth module
  if (Serial.available())
  {
    c = Serial.read();
    BTserial.write(c);
    
    if (NL) { Serial.print("\r\n>");  NL = false; }
    Serial.write(c);
    if (c==10) { NL = true; }
  }
    
   
}
